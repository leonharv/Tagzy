/*
 * tagzy 0.1.2 - jQuery tag field plugin
 *
 * Copyright (c) 2011 Philip Beel (http://www.theodin.co.uk/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 *
 */
(function(a){a.fn.tagzy=function(b){a(this).data("tagzy",{settings:{containerClass:"tags",tagClass:"tagged",inputClass:"tagzy_tag"},current_field:a(Element)});var c=a.extend(a(this).data("tagzy").settings,b);return this.each(function(b,d){function j(b){var d="",e;a('div[data-for="'+b+'"]').find("."+c.tagClass+":not(a)").each(function(b){e=a(this).text();d+=e.substring(0,e.length-1)+","});a('input[data-tagzy-identifier="'+b+'"]').val(d.substring(0,d.length-1))}var e=typeof e!=="undefined"?e++:e=0,f=a("<div/>",{"class":c.containerClass,style:"cursor:text;"});f.attr("data-for",e);a(d).attr("data-tagzy-identifier",e);var g=a("<input/>",{type:"text","class":c.inputClass}),h=f.append(g);a(this).after(h);var i=a(this).val().split(",");if(i.length>=1&i[0].length>=1){a.each(i,function(b,e){close=a("<a/>",{href:"#",title:"delete"}).append("x");newTag=a("<span/>").addClass(c.tagClass).append(e);a(d).next("."+c.containerClass).append(newTag.append(close));a(d).next().find("."+c.inputClass).appendTo(a(d).next("."+c.containerClass)).val("").focus();j(a(d).next("."+c.containerClass).attr("data-for"))})}a("."+c.containerClass).live("click",function(){a(this).find("."+c.inputClass).focus()});a("."+c.inputClass).keyup(function(b){var d,e,f,g;if((this.value.substr(-1)===","||b.keyCode===13)&&this.value.length!==1){e=a("<a/>",{href:"#",title:"delete"}).append("x");g=this.value.substr(-1)===","?1:0;d=a("<span/>").addClass(c.tagClass).append(this.value.substr(0,this.value.length-g));a(this).parent("."+c.containerClass).append(d.append(e));a(this).appendTo(a(this).parent("."+c.containerClass)).val("").focus();j(a(this).parent("."+c.containerClass).attr("data-for"))}});a("."+c.containerClass).find("."+c.tagClass+" a").live("click",function(b){b.preventDefault();var d=a(this).parent().parent().attr("data-for");a(this).parent().remove();j(d);a(this).parent().parent().find("."+c.inputClass).focus()});a("."+c.inputClass).keydown(function(b){if(b.keyCode===8||b.keyCode===13){b.preventDefault()}if(b.keyCode===8){if(a(this).val().length===0){a("."+c.tagClass+":last").remove();j(a(this).parent().attr("data-for"))}else{a(this).val(a(this).val().slice(0,-1))}}})})}})(jQuery)